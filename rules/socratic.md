# 苏格拉底质询协议

> 在展示报告后、确认存盘前执行。目标不是总结问题，是逼用户面对思维盲区。

## 前置：证据构建（内部执行，不展示）

从 facet 的 `ai_collab` 字段 + 原始 session 中寻找五类嫌疑：

**阿谀陷阱 (Sycophancy Trap)**
用户问了引导性问题（"这样是不是更好？""用户应该会喜欢吧？"），AI 顺着说了。
→ 标志：ai_collab.sycophancy 有值

**逻辑跳跃 (Logic Leap)**
从用研直接跳到设计、从需求直接跳到代码，中间缺推导步骤。
→ 标志：ai_collab.logic_leap 有值，或相邻 session 的 goal_category 跨度大

**思维偷懒 (Lazy Prompting)**
直接问"怎么解决"而不是"为什么出错"。
→ 标志：ai_collab.lazy_prompting 有值

**自动化投降 (Automation Surrender)**
AI 给出代码/方案后直接使用，未验证正确性、未检查边界条件、未理解底层逻辑。
→ 标志：ai_collab.automation_surrender 有值

**锚定效应 (Anchoring Effect)**
被 AI 给出的第一个方案锚定思维，未探索替代方案、未质疑是否最优。
→ 标志：ai_collab.anchoring_effect 有值

如果 facet 中证据不足，回到原始 session 数据补充。
构建至少 3 条"起诉书"后进入质询。

## 可选 Round 0.5: 亮点确认

> 在攻击性质询前，先用 1-2 句话确认正向行为。降低用户防御心理。

IF 本轮有 validated_highlights（来自阶段 A.0）:
  用 1-2 句话确认亮点，例如：
  「大锅，这轮做得好的：[asset_title] 规则你执行到位了，效果也验证了。」
  不展开讨论，快速进入 Round 1。

IF 无 validated_highlights:
  跳过，直接进入 Round 1。

## 执行：3 轮质询

### 铁律

1. **必须引用原文** — 指出具体 session 日期 + 用户原话 + AI 回应
2. **必须挑战假设** — 不问"你怎么看"，问"证据在哪"
3. **禁止废话** — 不问感受，只问逻辑

### 提问武器库

- 「在 [日期] 的会话中，你问 AI '[原话]'。你凭什么认为 AI 能代表真实用户？数据在哪？」
- 「你直接用了 AI 推荐的 [X]，是因为最适合，还是因为给代码最快？」
- 「从 [A] 到 [B]，中间的推导过程呢？补上。」
- 「你说你懂了 [X]，不看 AI 代码，你能从零说出思路吗？」
- 「这个结论是你从数据中发现的，还是 AI 说的你就信了？」
- 「AI 给了你 [X] 方案，你验证过它的正确性吗？还是直接 copy-paste 了？」
- 「你用了 AI 第一个建议的 [方案]。你考虑过替代方案吗？还是被第一印象锚定了？」

### 流程

每轮：
1. 提出 1-2 个攻击性问题（必须有证据）
2. 等用户回答
3. 用户有理有据 → 记录「已澄清」→ 下一轮
   用户说不清楚 → 记录「认知缺陷」→ 追问

## 第 4 轮：触发条件提炼 (Trigger Distillation)

> 把质询中暴露的隐性知识，当场压成结构化的 Gene 触发条件。不可跳过。

### 前置条件

第 1-3 轮已完成，已产出「思维尸检」初稿和「行为纠偏指南」初稿。

### 额外弹药来源

如果本次复盘执行了 Gene 验证（阶段 A.0），以下验证发现也作为第 4 轮的输入：
- 「遵守但无效」的 Gene → 追问规则是否需要修订
- 「未遵守但成功」的 Gene → 追问 trigger 是否过宽
- SOP/Pref 偏离 → 追问是否需要更新规则

### 执行逻辑

```
FOR each 行为纠偏指南中的「强制约束」:
  以及 Gene 验证中需要修订的资产:

  1. 向用户提出结构化提问（不可绕过）：

     「你刚才说 [引用用户在质询中的回答]。
      现在把它变成规则：

      IF _______ THEN 执行这个做法
      IF _______ THEN 不需要（跳过条件）

      填不出来也没关系，说你的直觉，我帮你转译。」

  2. 用户回答后，Agent 做两件事：
     a. 将用户的自然语言转译为伪代码格式的 trigger/skip_when
     b. 回显给用户确认：「我理解的是：
        IF [伪代码条件] THEN [做法]
        SKIP IF [伪代码条件]
        对吗？」

  3. 用户确认 → 暂存为 Gene 候选（status = 待Gene化）
     用户修正 → 按修正后版本暂存

  特殊情况处理：
  - 用户说「说不清楚」
    → Agent 基于 facet 证据给出 2 个候选 trigger，让用户选
    → 选中的暂存为 Gene 候选

  - 用户说「这个不需要规则化」
    → 追问：「那你怎么保证下次不犯？」
    → 用户给出合理论证 → 记录「已澄清，不 Gene 化」，附用户论证
    → 用户说不清 → 标记「待观察」，下次复盘再验证
```

### 产出

追加到报告末尾（在「思维尸检」和「行为纠偏指南」之后）：

```markdown
### 提炼的 Gene 候选

| ID（建议） | 触发条件 | 跳过条件 | 来源 | 状态 |
|-----------|---------|---------|------|------|
| [kebab-case] | IF [伪代码] | IF [伪代码] | 质询第N轮 / Gene验证 | 待 Gene 化 |
| — | 用户说不清 | — | 质询第N轮 | 待观察 |
| — | — | — | 质询第N轮 | 已澄清，不 Gene 化 |
```

### 与 Step 6 的衔接

第 4 轮产出的 Gene 候选列表，在用户确认报告后，由 Step 6（Gene 化）统一处理：
- 「待 Gene 化」→ 进入 [gene-protocol.md](gene-protocol.md) 的 Step 6.1-6.5
- 「待观察」→ 记录到 evolution.jsonl（event: "pending_observation"），不写入 genes.json
- 「已澄清」→ 不做任何处理

## 输出：追加到报告末尾

质询完成后追加：

    ### 思维尸检
    - **本项目最大认知缺陷**：[描述 + 证据]
    - **触发场景**：[什么时候容易犯]
    - **严重程度**：高/中/低

    ### 行为纠偏指南
    对每个缺陷：
    1. **强制约束**：下一项目必须遵守的规则
    2. **检查点**：怎么判断自己没犯
    3. **触发器**：什么信号提醒你正在犯

    ### 提炼的 Gene 候选
    （由第 4 轮产出，格式见上方「第 4 轮」section）

## 特殊情况

- 全部澄清 → 「本轮无显著认知缺陷，建议日常使用 /feynman 保持自检」
- facet 中 ai_collab 全空 → 基于 friction + outcome 推断协作问题
- 语气可以尖锐，但必须有据，不能无端指控
